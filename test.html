<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>对角线拉伸示例（不裁剪版）</title>
  <style>
    #container {
        width: 400px;
        height: 300px;
        margin: 50px auto;
        /* 去掉 overflow: hidden，改为可见 */
        overflow: visible;
        position: relative;
        /* 透明背景，只有边框 */
        background: transparent;
        border: 1px solid #ccc;
    }
    #container img {
        width:70vh;
        height: auto;
        transform-origin: center;
        will-change: transform;
        transition: transform 0.15s ease-out;
        /* 保证图片在容器之上，不被其他元素遮挡 */
        position: relative;
        z-index: 1;
    }
  </style>
</head>
<body>
  <div id="container">
    <img id="diagonalImg" src="title.png" alt="示例图片">
  </div>

  <script>
    (function() {
      const container = document.getElementById('container');
      const img       = document.getElementById('diagonalImg');
      const maxStretch = 0.5;

      let box       = null;
      let ticking   = false;
      let lastEvent = null;

      function updateBox() {
        box = container.getBoundingClientRect();
      }
      window.addEventListener('resize', updateBox);
      updateBox();

      function applyTransform(e) {
        const x  = e.clientX - box.left;
        const y  = e.clientY - box.top;
        // 只在容器内部响应
        if (x < 0 || x > box.width || y < 0 || y > box.height) {
          resetTransform();
          ticking = false;
          return;
        }
        const nx   = (x / box.width)  * 2 - 1;
        const ny   = (y / box.height) * 2 - 1;
        const proj = (nx - ny) / 2;
        const scale = 1 + proj * maxStretch;
        img.style.transform = `
          rotate(45deg)
          scaleX(${scale.toFixed(3)})
          rotate(-45deg)
        `;
        ticking = false;
      }

      function onPointerMove(e) {
        lastEvent = e;
        if (!ticking) {
          ticking = true;
          requestAnimationFrame(() => applyTransform(lastEvent));
        }
      }

      function resetTransform() {
        img.style.transform = '';
      }

      container.addEventListener('pointermove', onPointerMove);
      container.addEventListener('pointerleave', resetTransform);
      container.addEventListener('pointercancel', resetTransform);
      container.addEventListener('pointerout', resetTransform);
    })();
  </script>
</body>
</html>