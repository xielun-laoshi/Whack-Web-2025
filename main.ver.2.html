<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>improved main page</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            scroll-behavior: smooth;
            overflow: hidden;
        }
        #mouse-follower {
            position: fixed;
            display: none;
            pointer-events: none;
            width: 110px;
            height: 56px;
            z-index: 1000;
            transition: transform 0.1s;
            will-change: transform, left, top;
        }
        .scroll-container {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }
        .page {
            height: 100vh;
            scroll-snap-align: start;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            justify-content: center;
            align-items: center;        
        }
        /* --- Copied from main.html --- */
        .background {
            position: absolute;
            width: 101vw;
            height: 101vh;
            top: -5px;
            left: -5px;
            background: url("../images/sky.png") center/cover no-repeat;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: -2;
            transition: transform 0.05s, background-position 0.05s;
            will-change: transform, background-position;
        }
        .wave {
            position: absolute;
            bottom: -55px;
            left: -110px;
            width: 115vw;
            height: 120vh;
            object-fit: cover;
            pointer-events: none;
            transform: translateX(-50%);
            transition: transform 0.05s;
            z-index: -1;
            will-change: transform;
        }
        #wave4 {
            z-index: 1;
        }
        #title {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            position: relative;
            z-index: 2;
            top:-30px;
        }
        #container {
            position: relative;
            perspective: 800px;
            justify-content: center;
            align-items: center;
            display: inline-block;
            max-width: 90vw;
            max-height: 70vh;
            z-index: 10;
        }
        .img-layer {
            position: absolute;
            width: 100vh;
            max-width: 100vw;
            height: auto;
            transform-origin: center;
            transition: transform 0.15s ease-out;
            will-change: transform;
        }
        #shadowImg {
            z-index: 0;
        }
        #mainImg {
            z-index: 1;
            position: relative;
        }
    </style>
</head>
<body>
    <img id="mouse-follower" src="../images/mouse.png" aria-hidden="true">
    <div class="scroll-container">
        <section class="page">
            <!-- Background and waves from main.html -->
            <div class="background" aria-hidden="true"></div>
            <img class="wave" id="wave1" src="../images/wave1.png" loading="lazy">
            <img class="wave" id="wave2" src="../images/wave2.png" loading="lazy">
            <img class="wave" id="wave3" src="../images/wave3.png" loading="lazy">
            <img class="wave" id="wave4" src="../images/wave4.png" loading="lazy">
            <!-- Title from main.html -->
            <div id="title" role="banner">
                <div id="container">
                    <img id="shadowImg" class="img-layer" src="../images/shadow.png">
                    <img id="mainImg" class="img-layer" src="../images/title.png">
                </div>
            </div>
        </section>
        <section class="page">Page 2</section>
        <section class="page">Page 3</section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const follower = document.getElementById('mouse-follower');
            const bg = document.querySelector('.background');
            const waves = Array.from(document.querySelectorAll('.wave'));

            // Mouse follower logic
            let targetX = window.innerWidth / 2;
            let targetY = window.innerHeight / 2;
            let currentX = targetX;
            let currentY = targetY;

            document.addEventListener('mousemove', e => {
                targetX = e.clientX - 51;
                targetY = e.clientY - 24;
                follower.style.display = 'block';
            });

            function animateFollower() {
                currentX += (targetX - currentX) * 0.1;
                currentY += (targetY - currentY) * 0.1;
                follower.style.left = `${currentX}px`;
                follower.style.top = `${currentY}px`;
                requestAnimationFrame(animateFollower);
            }
            animateFollower();

            document.addEventListener('mousedown', () => {
                follower.style.transform = 'scale(0.4)';
            });
            document.addEventListener('mouseup', () => {
                follower.style.transform = '';
            });

            // Parallax effect for background and waves
            let offsetX = 0, offsetY = 0;
            const moveFactors = [0.005, 0.05, 0.1, 0.15];

            let parallaxRAF = false;
            let lastMouseEvent = null;

            document.addEventListener('mousemove', e => {
                lastMouseEvent = e;
                if (!parallaxRAF) {
                    parallaxRAF = true;
                    requestAnimationFrame(updateParallax);
                }
            });

            function updateParallax() {
                if (!lastMouseEvent) return;
                offsetX = lastMouseEvent.clientX - window.innerWidth / 2;
                offsetY = lastMouseEvent.clientY - window.innerHeight / 2;

                bg.style.backgroundPosition = `${-offsetX * 0.005}px ${-offsetY * 0.005}px`;
                waves.forEach((wave, i) => {
                    const tx = offsetX * moveFactors[i];
                    const ty = offsetY * moveFactors[i];
                    wave.style.transform = `translate(${tx}px, ${ty}px)`;
                });
                parallaxRAF = false;
            }

            // Title 3D effect
            const container = document.getElementById('container');
            const mainImg = document.getElementById('mainImg');
            const shadowImg = document.getElementById('shadowImg');
            const maxRotation = 15;
            const maxScale = 1.1;
            const shadowOffset = 10;
            let box = null;
            let ticking = false;
            let lastEvent = null;

            function updateBox() {
                box = container.getBoundingClientRect();
            }

            function applyTransform(e) {
                const centerX = box.left + box.width / 2;
                const centerY = box.top + box.height / 2;
                const dx = e.clientX - centerX;
                const dy = e.clientY - centerY;

                const percentX = dx / (box.width / 2);
                const percentY = dy / (box.height / 2);

                const rotateX = (-percentY * maxRotation).toFixed(2);
                const rotateY = (percentX * maxRotation).toFixed(2);
                const scale = (1 + ((Math.abs(percentX) + Math.abs(percentY)) / 2) * (maxScale - 1)).toFixed(3);

                mainImg.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(${scale})`;

                const shadowScale = (scale * 1.07).toFixed(3);
                const offsetX = (percentX * shadowOffset).toFixed(1);
                const offsetY = (percentY * shadowOffset).toFixed(1);
                shadowImg.style.transform = `translate(${offsetX}px, ${offsetY}px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(${shadowScale})`;

                ticking = false;
            }

            function onPointerMove(e) {
                lastEvent = e;
                if (!ticking) {
                    ticking = true;
                    requestAnimationFrame(() => applyTransform(lastEvent));
                }
            }

            function resetTransform() {
                mainImg.style.transform = '';
                shadowImg.style.transform = '';
                ticking = false;
            }

            mainImg.addEventListener('load', updateBox);
            window.addEventListener('resize', updateBox);
            window.addEventListener('pointermove', onPointerMove);
            window.addEventListener('blur', resetTransform);

            updateBox();
        });
    </script>
</body>
</html>