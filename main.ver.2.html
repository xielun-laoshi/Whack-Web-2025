<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>improved main page</title>
  <style>
    #loader-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .loader {
      width: 60px;
      aspect-ratio: 1;
      background:
        linear-gradient(90deg, #ffffff 50%, #2758e2 0) top/100% 50% no-repeat,
        linear-gradient(90deg, #3abef9 50%, #fb6222 0);
      -webkit-mask: linear-gradient(#000 0 0) 0 0/50% 50% no-repeat;
      mask: linear-gradient(#000 0 0) 0 0/50% 50% no-repeat;
      animation: l18 2s infinite;
    }

    @keyframes l18 {
      0%   { -webkit-mask-position: 0 0 }
      25%  { -webkit-mask-position: 100% 0 }
      50%  { -webkit-mask-position: 100% 100% }
      75%  { -webkit-mask-position: 0 100% }
      100% { -webkit-mask-position: 0 0 }
    }

    html, body {
      height: 100%;
      margin: 0;
      scroll-behavior: smooth;
      overflow: hidden;
    }

    .scroll-container {
      height: 100vh;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .page {
      height: 100vh;
      scroll-snap-align: start;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      justify-content: center;
      align-items: center;
    }

    .background {
      position: absolute;
      width: 101vw;
      height: 101vh;
      top: -5px;
      left: -5px;
      background: url("../images/sky.gif") center/cover no-repeat;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: -2;
      will-change: background-position;
    }

    .wave, .bottom-img, .beneath-img {
      position: absolute;
      bottom: -72px;
      left: -10vw;
      width: 120vw;
      height: 120vh;
      object-fit: cover;
      pointer-events: none;
      transform: translateX(-50%);
      will-change: transform;
      z-index: -1;
    }

    #title {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.4s ease, transform 0.4s ease;
      pointer-events: none;
    }

    #container {
      position: relative;
      perspective: 800px;
      justify-content: center;
      align-items: center;
      display: inline-block;
      max-width: 90vw;
      max-height: 70vh;
      z-index: 10;
      width: 60vw;
      min-width: 220px;
    }

    .img-layer {
      position: absolute;
      width: 100%;
      max-width: 100vw;
      height: auto;
      transform-origin: center;
      will-change: transform;
    }

    #shadowImg { z-index: 0; }
    #mainImg { z-index: 1; position: relative; }

    .bottom-images, .beneath-images {
      position: absolute;
      width: 100vw;
      height: 100vh;
      left: 0;
      top: 0;
      pointer-events: none;
      z-index: 0;
    }

    @media (max-width: 700px) {
      #container { width: 85vw; max-width: 60vh; }
    }

    @media (max-width: 450px) {
      #container { width: 98vw; max-width: 40vh; }
    }

    #loader-gif {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
    }
  </style>
</head>
<body>
  <div id="loader-wrapper"><div class="loader"></div></div>
  <div id="loader-gif">
    <img src="../images/Loader.gif" alt="Loading..." style="width: 100vw; height: 100vh;" data-duration="1785">
  </div>

  <div class="scroll-container">
    <section class="page page1">
      <div class="background" aria-hidden="true"></div>
      <a id="mlh-trust-badge" style="display:block;max-width:100px;min-width:60px;position:absolute;right:50px;top:0;width:10%;z-index:100" href="https://mlh.io/na?utm_source=na-hackathon&utm_medium=TrustBadge&utm_campaign=2026-season&utm_content=white" target="_blank"><img src="https://s3.amazonaws.com/logged-assets/trust-badge/2026/mlh-trust-badge-2026-white.svg" alt="Major League Hacking 2026 Hackathon Season" style="width:100%"></a>
      <img class="wave" id="wave1" src="../images/wave1.png" loading="lazy">
      <img class="wave" id="wave2" src="../images/wave2.gif" loading="lazy">
      <img class="wave" id="wave3" src="../images/wave3.gif" loading="lazy">
      <img class="wave" id="wave4" src="../images/wave4.gif" loading="lazy">
      <div id="title" role="banner">
        <div id="container">
          <img id="shadowImg" class="img-layer" src="../images/shadow.png" loading="lazy">
          <img id="mainImg" class="img-layer" src="../images/title.png" loading="lazy">
        </div>
      </div>
    </section>

    <section class="page page2">
      <div class="beneath-images">
        <img class="beneath-img" id="beneath1" src="../images/Beneath1.gif" loading="lazy" style="z-index: 3;">
        <img class="beneath-img" id="beneath2" src="../images/Beneath2.gif" loading="lazy" style="z-index: 2;">
        <img class="beneath-img" id="beneath3" src="../images/Beneath3.gif" loading="lazy" style="z-index: 1;">
        <img class="beneath-img" id="beneath4" src="../images/Beneath4.png" loading="lazy" style="z-index: 0;">
      </div>
    </section>

    <section class="page page3">
      <div class="bottom-images">
        <img class="bottom-img" id="bottom5" src="../images/bottom5.png" loading="lazy" style="z-index: 0;">
        <img class="bottom-img" id="bottom4" src="../images/bottom4.png" loading="lazy" style="z-index: 1;">
        <img class="bottom-img" id="bottom3" src="../images/bottom3.png" loading="lazy" style="z-index: 2;">
        <img class="bottom-img" id="bottom2" src="../images/bottom2.gif" loading="lazy" style="z-index: 3;">
        <img class="bottom-img" id="bottom1" src="../images/bottom1.gif" loading="lazy" style="z-index: 4;">
      </div>
    </section>
  </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Cache DOM elements
        const bg = document.querySelector('.background');
        const waves = document.querySelectorAll('.wave');
        const container = document.getElementById('container');
        const mainImg = document.getElementById('mainImg');
        const shadowImg = document.getElementById('shadowImg');
        const title = document.getElementById('title');
        const scrollContainer = document.querySelector('.scroll-container');
        const loaderGif = document.getElementById('loader-gif');
        const loaderGifImg = loaderGif?.querySelector('img');
        
        // Cache styles for performance
        const bgStyle = bg.style;
        const mainImgStyle = mainImg.style;
        const shadowImgStyle = shadowImg.style;
        const titleStyle = title.style;
        const loaderGifStyle = loaderGif?.style;

        // Movement and animation variables
        const moveFactors = [0.005, 0.05, 0.1, 0.15, 0.2];
        const centerX = window.innerWidth * 0.5;
        const centerY = window.innerHeight * 0.5;
        let box = null;
        let lastX = centerX, lastY = centerY;
        let isAnimating = true;

        // Cache bottom and beneath images with their styles
        const bottomImgs = [];
        const beneathImgs = [];
        
        for (let i = 1; i <= 5; i++) {
            const img = document.getElementById(`bottom${i}`);
            if (img) bottomImgs.push({el: img, style: img.style});
        }
        
        for (let i = 1; i <= 4; i++) {
            const img = document.getElementById(`beneath${i}`);
            if (img) beneathImgs.push({el: img, style: img.style});
        }

        // Optimized box update
        function updateBox() { 
            box = container.getBoundingClientRect(); 
        }
        
        mainImg.addEventListener('load', updateBox);
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(updateBox, 16);
        });

        // Throttled pointer movement for parallax effects
        let pointerMoveQueued = false;
        function onPointerMove(e) {
            if (pointerMoveQueued) return;
            pointerMoveQueued = true;
            
            requestAnimationFrame(() => {
                const clientX = e.clientX;
                const clientY = e.clientY;
                lastX = clientX;
                lastY = clientY;
                pointerMoveQueued = false;
            });
        }
        
        window.addEventListener('pointermove', onPointerMove, {passive: true});

        // Optimized animation loop
        function animate() {
            if (!isAnimating) return;

            // Update parallax effects
            if (box) {
                const offsetX = lastX - centerX;
                const offsetY = lastY - centerY;
                
                // Background parallax
                bgStyle.backgroundPosition = `${-offsetX * moveFactors[0]}px ${-offsetY * moveFactors[0]}px`;
                
                // Wave parallax
                waves.forEach((wave, i) => {
                    const tx = offsetX * moveFactors[i];
                    const ty = offsetY * moveFactors[i];
                    wave.style.transform = `translate3d(${tx}px, ${ty}px, 0)`;
                });

                // Bottom images parallax
                bottomImgs.forEach((imgObj, i) => {
                    const factor = moveFactors[moveFactors.length - 1 - i];
                    const tx = offsetX * factor * 0.75;
                    const ty = offsetY * factor * 0.75;
                    imgObj.style.transform = `translate3d(${tx}px, ${ty}px, 0)`;
                });

                // Beneath images parallax
                beneathImgs.forEach((imgObj, i) => {
                    const factor = moveFactors[moveFactors.length - 1 - i];
                    const tx = offsetX * factor * 1.1;
                    const ty = offsetY * factor * 1.1;
                    imgObj.style.transform = `translate3d(${tx}px, ${ty}px, 0)`;
                });

                // 3D tilt effect
                const centerBx = box.left + box.width * 0.5;
                const centerBy = box.top + box.height * 0.5;
                const dx = lastX - centerBx;
                const dy = lastY - centerBy;
                const percentX = dx / (box.width * 0.5);
                const percentY = dy / (box.height * 0.5);
                
                const rotateX = (-percentY * 15);
                const rotateY = (percentX * 15);
                const scale = 1 + ((Math.abs(percentX) + Math.abs(percentY)) * 0.5) * 0.1;
                
                mainImgStyle.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(${scale}, ${scale}, 1)`;
                
                const shadowScale = scale * 1.07;
                const offsetX2 = percentX * 10;
                const offsetY2 = percentY * 10;
                shadowImgStyle.transform = `translate3d(${offsetX2}px, ${offsetY2}px, 0) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(${shadowScale}, ${shadowScale}, 1)`;
            }
            
            requestAnimationFrame(animate);
        }
        
        // Start animation
        requestAnimationFrame(animate);

        // Reset on blur
        window.addEventListener('blur', () => {
            mainImgStyle.transform = '';
            shadowImgStyle.transform = '';
        });

        // Loader GIF management
        const loaderGifDuration = parseInt(loaderGifImg?.dataset.duration) || 1785;
        let currentGifSrc = '';

        function showLoaderGif() {
            if (!loaderGif || !loaderGifImg) return;
            
            // Refresh GIF by changing src to restart animation
            if (!currentGifSrc) currentGifSrc = loaderGifImg.src;
            loaderGifImg.src = currentGifSrc + '?t=' + Date.now();
            
            loaderGifStyle.opacity = '1';
            loaderGifStyle.pointerEvents = 'auto';
        }

        function hideLoaderGif() {
            if (loaderGif) {
                loaderGifStyle.opacity = '0';
                loaderGifStyle.pointerEvents = 'none';
            }
        }

        // Improved scroll handling with precise page control
        const vh = window.innerHeight;
        let isScrolling = false;
        let scrollAccumulator = 0;
        const scrollThreshold = 50; // Minimum delta to trigger scroll
        const scrollCooldown = 100; // Cooldown between scroll actions
        
        // Get current page index
        function getCurrentPageIndex() {
            const scrollY = scrollContainer.scrollTop;
            return Math.round(scrollY / vh);
        }
        
        // Scroll to specific page with animation sequence
        function scrollToPage(pageIndex) {
            if (isScrolling) return;
            
            const targetScroll = pageIndex * vh;
            const currentScroll = scrollContainer.scrollTop;
            
            if (Math.abs(targetScroll - currentScroll) < 10) return; // Already at target
            
            isScrolling = true;
            
            // Show loader GIF first
            showLoaderGif();
            
            // Wait for loading animation to start, then scroll
            setTimeout(() => {
                scrollContainer.scrollTo({
                    top: targetScroll,
                    behavior: 'smooth'
                });
                
                // Hide loader after animation duration
                setTimeout(() => {
                    hideLoaderGif();
                    
                    // Reset scroll state after cooldown
                    setTimeout(() => {
                        isScrolling = false;
                        scrollAccumulator = 0;
                    }, scrollCooldown);
                }, loaderGifDuration);
                
            }, 50); // Small delay to ensure GIF starts
        }

        // Enhanced wheel event handler
        scrollContainer.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            if (isScrolling) return;
            
            const delta = e.deltaY;
            scrollAccumulator += delta;
            
            // Check if we've accumulated enough scroll to trigger page change
            if (Math.abs(scrollAccumulator) >= scrollThreshold) {
                const currentPage = getCurrentPageIndex();
                const maxPage = 2; // 0, 1, 2 (three pages total)
                
                let targetPage = currentPage;
                
                if (scrollAccumulator > 0 && currentPage < maxPage) {
                    // Scroll down
                    targetPage = currentPage + 1;
                } else if (scrollAccumulator < 0 && currentPage > 0) {
                    // Scroll up
                    targetPage = currentPage - 1;
                }
                
                if (targetPage !== currentPage) {
                    scrollToPage(targetPage);
                } else {
                    // Reset accumulator if we can't scroll further
                    scrollAccumulator = 0;
                }
            }
        }, { passive: false });

        // Handle touch events for mobile
        let touchStartY = 0;
        let touchEndY = 0;
        
        scrollContainer.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        scrollContainer.addEventListener('touchend', (e) => {
            touchEndY = e.changedTouches[0].clientY;
            const touchDelta = touchStartY - touchEndY;
            
            if (Math.abs(touchDelta) > 50 && !isScrolling) {
                const currentPage = getCurrentPageIndex();
                const maxPage = 2;
                
                let targetPage = currentPage;
                
                if (touchDelta > 0 && currentPage < maxPage) {
                    // Swipe up (scroll down)
                    targetPage = currentPage + 1;
                } else if (touchDelta < 0 && currentPage > 0) {
                    // Swipe down (scroll up)
                    targetPage = currentPage - 1;
                }
                
                if (targetPage !== currentPage) {
                    scrollToPage(targetPage);
                }
            }
        }, { passive: true });

        // Optimized scroll position tracking for title opacity
        let scrollTicking = false;
        
        function onScroll() {
            if (scrollTicking) return;
            scrollTicking = true;
            
            requestAnimationFrame(() => {
                const scrollY = scrollContainer.scrollTop;
                
                if (scrollY < vh) {
                    titleStyle.opacity = '1';
                    titleStyle.transform = 'translate(-50%, -50%)';
                } else if (scrollY < vh * 2) {
                    const progress = (scrollY - vh) / vh;
                    titleStyle.opacity = 1 - 0.5 * progress;
                    titleStyle.transform = 'translate(-50%, -50%)';
                } else {
                    titleStyle.opacity = '0.5';
                    titleStyle.transform = 'translate(-50%, -100vh)';
                }
                
                scrollTicking = false;
            });
        }
        
        scrollContainer.addEventListener('scroll', onScroll, {passive: true});
        onScroll();
        updateBox();
    });

    // Optimized window load handler
    window.addEventListener('load', () => {
        const loader = document.getElementById('loader-wrapper');
        const loaderGif = document.getElementById('loader-gif');

        if (!loader) {
            document.body.classList.remove('loading-bg');
            return;
        }

        // Show loader GIF after 500ms
        const showGifTimer = setTimeout(() => {
            if (loaderGif) {
                loaderGif.style.opacity = '1';
                loaderGif.style.pointerEvents = 'auto';
            }
        }, 500);

        // Hide main loader after 1000ms
        const hideLoaderTimer = setTimeout(() => {
            loader.style.opacity = '0';
            
            const removeLoaderTimer = setTimeout(() => {
                loader.remove();
                
                const finalCleanupTimer = setTimeout(() => {
                    if (loaderGif) {
                        loaderGif.style.opacity = '0';
                        loaderGif.style.pointerEvents = 'none';
                    }
                    document.body.classList.remove('loading-bg');
                }, 120);
            }, 500);
        }, 1000);
    });
</script>
</body>
</html>